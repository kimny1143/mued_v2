# MIDI-LLM統合：ユーザー体験設計書

**作成日**: 2025-01-11
**対象**: MUED v2の教材生成機能強化
**目的**: MIDI-LLMをMUEDのどの機能にどう統合し、ユーザーがどう使うかを明確化

---

## 1. 統合対象の既存機能（3つ）

MIDI-LLMは、MUEDの以下3つの既存機能を**段階的に強化**します。

### 🎯 機能1: **AI教材生成**（最優先）
**現在のパス**: `/dashboard/materials/new`
**ユーザー**: 教師、メンター、学習者
**統合方法**: OpenAI APIの選択肢として追加

### 🎯 機能2: **弱点ドリル自動生成**（Phase 2）
**現在のボタン**: 音楽プレイヤー内の「弱点ドリル生成」
**ユーザー**: 学習者
**統合方法**: パーソナライズ強化

### 🎯 機能3: **音楽作曲アシスタント**（Phase 3、新機能）
**新規パス**: `/dashboard/composer`（新設）
**ユーザー**: 創造性を求める教師・学習者
**統合方法**: 双方向編集フロー

---

## 2. 機能1: AI教材生成の統合（Phase 1）

### 2.1 現在のユーザー体験

```
[ユーザーの行動フロー]

1. 教師が「新しい教材を作成」をクリック
   ↓
2. 自然言語で入力
   「初心者向けのCメジャースケール練習曲、ピアノ、4分音符中心」
   ↓
3. 「生成」ボタンをクリック
   ↓
4. 8-15秒待つ（OpenAI API処理中）
   ↓
5. 楽譜が表示される（abcjs）
   - 五線譜
   - 再生ボタン
   - 学習ポイント
   - 練習指示
   ↓
6. 品質確認後、保存または再生成
```

**使用技術**: OpenAI API（GPT-5-mini） → ABC記法直接生成

### 2.2 MIDI-LLM統合後のユーザー体験

```
[ユーザーの行動フロー - ほぼ同じ]

1. 教師が「新しい教材を作成」をクリック
   ↓
2. 自然言語で入力
   「初心者向けのCメジャースケール練習曲、ピアノ、4分音符中心」
   ↓
3. ★【新規】生成エンジン選択（オプション）
   - 🔵 標準（OpenAI） - 推奨
   - 🟢 音楽専用AI（MIDI-LLM） - Beta
   ↓
4. 「生成」ボタンをクリック
   ↓
5. 8-15秒待つ
   ★【違い】MIDI-LLMの場合、進捗表示
   「♪ 音楽を作曲中... 80%」
   ↓
6. 楽譜が表示される（abcjs）
   - 五線譜
   - 再生ボタン
   - 学習ポイント
   - 練習指示
   ★【新規】MIDI形式でダウンロード可能
   ↓
7. 品質確認後、保存または再生成
   ★【新規】「別のバリエーションを生成」ボタン
```

### 2.3 UIの変更点（最小限）

#### Before（現在）
```
┌─────────────────────────────────────┐
│ どんな教材が欲しいですか？           │
├─────────────────────────────────────┤
│ [テキストエリア]                    │
│ 「初心者向けのピアノ練習曲...」      │
│                                     │
├─────────────────────────────────────┤
│        [生成] ボタン                │
└─────────────────────────────────────┘
```

#### After（MIDI-LLM統合後）
```
┌─────────────────────────────────────┐
│ どんな教材が欲しいですか？           │
├─────────────────────────────────────┤
│ [テキストエリア]                    │
│ 「初心者向けのピアノ練習曲...」      │
│                                     │
├─────────────────────────────────────┤
│ 生成エンジン:                       │
│ ○ 標準（OpenAI）- 推奨              │
│ ○ 音楽専用AI（MIDI-LLM）- Beta      │
│   └ より音楽理論に忠実な楽譜        │
│   └ MIDI形式でダウンロード可能      │
├─────────────────────────────────────┤
│        [生成] ボタン                │
└─────────────────────────────────────┘
```

**変更箇所**: ラジオボタン2つ追加のみ（デフォルトはOpenAI）

### 2.4 ユーザーにとってのメリット

| ユーザー種別 | メリット |
|------------|---------|
| **教師** | ✅ より音楽理論的に正確な楽譜<br/>✅ MIDI形式でDAWに取り込める<br/>✅ 複数バリエーション生成が高速 |
| **学習者** | ✅ 同じテーマで難易度違いの楽譜を即座に入手<br/>✅ 練習用MIDIファイルをダウンロード |
| **MUED運営** | ✅ OpenAI APIコスト削減（月間1000生成以上で）<br/>✅ 音楽教育に特化したブランディング |

### 2.5 システムの裏側（ユーザーには見えない）

```
[ユーザー入力]
「初心者向けのCメジャースケール練習曲」
    ↓
[意図解析 - OpenAI API]
{ instrument: "piano", difficulty: "beginner", key: "C major" }
    ↓
[生成エンジン選択]
    ├─ OpenAI API → ABC記法直接生成
    └─ MIDI-LLM → MIDI生成 → ABC変換
            ↓
    [Modal.com - vLLM]
    MIDI-LLMが8小節のMIDI生成（8秒）
            ↓
    [Vercel - midi2abc変換]
    MIDI → ABC記法（2秒）
            ↓
[共通フロー]
ABC記法 → Quality Gate → DB保存 → abcjs表示
```

---

## 3. 機能2: 弱点ドリル自動生成の強化（Phase 2）

### 3.1 現在のユーザー体験

```
[学習者の行動フロー]

1. 楽譜を練習中
   ↓
2. 4-6小節目が難しくて、何度もループ再生
   （システムが自動で弱点箇所を記録）
   ↓
3. 「弱点ドリル生成」ボタンが出現
   ↓
4. クリックすると、AIが以下を生成：
   - 同レベルの練習曲
   - 少し簡単な練習曲
   - 少し難しい練習曲
   ↓
5. 3つのドリルを比較して選択
   ↓
6. 練習開始
```

**課題**:
- OpenAI APIはABC記法生成に特化
- 弱点箇所の音楽的特徴（跳躍進行、リズム複雑性）を正確に反映しにくい

### 3.2 MIDI-LLM統合後のユーザー体験

```
[学習者の行動フロー - 同じ]

1. 楽譜を練習中
   ↓
2. 4-6小節目が難しくて、何度もループ再生
   ↓
3. 「弱点ドリル生成」ボタンが出現
   ↓
4. クリックすると、★【改善】
   AIが弱点箇所の音楽的特徴を分析：
   - 跳躍進行が多い → 順次進行のドリル
   - 16分音符が多い → 8分音符のドリル
   - テンポが速い → ゆっくりしたドリル
   ↓
5. ★【改善】5つのパーソナライズドリル生成
   - 段階的難易度調整
   - 同じ音楽的課題に特化
   ↓
6. 最適なドリルを選択して練習
```

### 3.3 ユーザーにとっての違い

| 項目 | OpenAI API（現在） | MIDI-LLM（統合後） |
|------|-------------------|-------------------|
| **生成速度** | 15-20秒 | 8-10秒 |
| **音楽的精度** | 🟡 中程度 | 🟢 高精度 |
| **パーソナライズ** | 🟡 テキスト説明ベース | 🟢 音楽構造解析ベース |
| **ドリル数** | 3つ固定 | 5-10個動的生成 |

### 3.4 具体例

#### Before（OpenAI）
```
弱点: 4-6小節目（跳躍進行が多い）

生成されるドリル:
1. 同レベル: ランダムな4小節の練習曲
2. 簡単: より短い2小節の練習曲
3. 難しい: より長い8小節の練習曲
```

#### After（MIDI-LLM）
```
弱点: 4-6小節目（跳躍進行が多い）
→ MIDI-LLMが音楽構造を解析

生成されるドリル:
1. 跳躍進行のみ: C-E-G（3度跳躍）
2. 跳躍進行のみ: C-G-C（5度跳躍）
3. 段階的移行: C-D-E-F-G（順次進行から跳躍へ）
4. 同じ跳躍パターン: 異なる調で同じ練習
5. 組み合わせ: 跳躍+リズム変化
```

---

## 4. 機能3: 音楽作曲アシスタント（Phase 3、新機能）

### 4.1 新機能の概要

**ターゲットユーザー**: 創造性を求める教師・上級学習者

**コンセプト**: 「AIと一緒に音楽を作る」体験

### 4.2 ユーザー体験フロー

```
[ユーザーの行動フロー]

1. 「作曲アシスタント」メニューをクリック
   ↓
2. ★【新規UI】音楽作曲インターフェース
   ┌─────────────────────────────────────┐
   │ [テキスト入力]                      │
   │ 「明るくて楽しいピアノ曲、Cメジャー」│
   │                                     │
   │ [生成]ボタン                        │
   └─────────────────────────────────────┘
   ↓
3. MIDI-LLMが16小節の楽曲を生成（10秒）
   ↓
4. ★【新規】楽譜とMIDIエディタが表示
   ┌─────────────────────────────────────┐
   │ [五線譜表示]                        │
   │ ♪♪♪♪♪♪♪♪                        │
   │                                     │
   │ [MIDIピアノロール]                  │
   │ ■■□■□■■■                        │
   │                                     │
   │ [編集パネル]                        │
   │ - 小節7-8を選択                     │
   │ - 「もっとリズミカルに」            │
   │ - [再生成]ボタン                    │
   └─────────────────────────────────────┘
   ↓
5. ユーザーが部分的に編集
   - テンポ変更
   - 楽器変更
   - 特定の小節だけ再生成
   ↓
6. AIが提案
   「この続きのメロディは？」
   → ユーザーが選択または拒否
   ↓
7. 完成した楽曲を保存
   - MIDI形式
   - ABC記法
   - 音声ファイル（MP3）
```

### 4.3 UIモックアップ（概念）

```
┌───────────────────────────────────────────────┐
│ 🎵 音楽作曲アシスタント                       │
├───────────────────────────────────────────────┤
│                                               │
│ [プロンプト入力]                              │
│ 「明るくて楽しいピアノ曲、Cメジャー、16小節」 │
│                                               │
│ [生成エンジン: MIDI-LLM ▼] [生成]            │
│                                               │
├───────────────────────────────────────────────┤
│                                               │
│ [五線譜プレビュー]                            │
│ ♪ ♪ ♪ ♪ ♪ ♪ ♪ ♪                            │
│                                               │
│ [小節1-16]                                    │
│ ██████████████████████████████████            │
│                                               │
├───────────────────────────────────────────────┤
│                                               │
│ [編集ツール]                                  │
│ □ 小節7-8を選択中                             │
│                                               │
│ 指示: [もっとリズミカルに      ]              │
│ [この部分を再生成]                            │
│                                               │
│ [元に戻す] [やり直し] [バリエーション生成]    │
│                                               │
├───────────────────────────────────────────────┤
│                                               │
│ [保存オプション]                              │
│ □ MIDI形式    □ ABC記法    □ MP3音声         │
│                                               │
│ [教材として保存] [個人コレクションに保存]     │
│                                               │
└───────────────────────────────────────────────┘
```

---

## 5. 段階的ロールアウト計画

### Phase 1: AI教材生成の選択肢追加（2-3週間）

**対象機能**: `/dashboard/materials/new`

**変更箇所**:
- UI: ラジオボタン2つ追加
- API: `/api/ai/materials`にMIDI-LLMルート追加
- インフラ: Modal.com最小構成

**ユーザー体験**:
- デフォルトはOpenAI（既存動作維持）
- 「Beta」ラベル付きでMIDI-LLMを選択可能
- フィードバック収集フォーム追加

**成功指標**:
- MIDI-LLM選択率: 10-20%
- 生成成功率: 95%以上
- ユーザー満足度: 4.0/5.0以上

---

### Phase 2: 弱点ドリル強化（4-6週間）

**対象機能**: WeakDrillButton（音楽プレイヤー内）

**変更箇所**:
- 弱点箇所の音楽的特徴分析ロジック
- MIDI-LLMへのパーソナライズプロンプト生成
- ドリル数を3→5-10個に拡大

**ユーザー体験**:
- 裏側でMIDI-LLMに切り替え（ユーザーは意識しない）
- より精度の高いドリル生成
- 「このドリルは役に立ちましたか？」フィードバック

**成功指標**:
- ドリル利用率: +30%向上
- 弱点克服速度: +20%改善
- ユーザー満足度: 4.5/5.0以上

---

### Phase 3: 作曲アシスタント新設（8-10週間）

**対象**: 新機能（`/dashboard/composer`）

**変更箇所**:
- 新規UI全体
- MIDIエディタコンポーネント
- 双方向編集フロー

**ユーザー体験**:
- 「Beta」ラベル付きで公開
- 招待制（プレミアムユーザーのみ）
- コミュニティフィードバック重視

**成功指標**:
- 週間アクティブユーザー: 50-100名
- 完成楽曲数: 200-500曲/月
- SNSシェア率: 20%以上

---

## 6. ユーザー別のバリュープロポジション

### 6.1 教師・メンター

**現在の課題**:
- 教材作成に30分-1時間かかる
- 難易度調整が難しい
- 同じテーマで複数バリエーションが欲しい

**MIDI-LLM統合後の解決**:
- ✅ 教材作成時間を5分に短縮
- ✅ ワンクリックで難易度違いの楽譜を生成
- ✅ MIDI形式でDAWに取り込み、さらに編集可能

**具体的な使い方**:
```
1. 「Cメジャースケール、初心者向け」と入力
2. 8秒で楽譜生成
3. 「もう少し難しく」と指示
4. 3秒でバリエーション生成
5. 両方を教材ライブラリに保存
```

---

### 6.2 学習者（初心者-中級者）

**現在の課題**:
- 自分のレベルに合った練習曲が見つからない
- 苦手な箇所を克服する教材が少ない
- 楽しく練習したいが、単調になりがち

**MIDI-LLM統合後の解決**:
- ✅ 自分専用のパーソナライズドリル
- ✅ 苦手箇所に特化した段階的練習
- ✅ 毎回違うバリエーションで飽きない

**具体的な使い方**:
```
1. ピアノ練習中、4-6小節目で何度もつまずく
2. システムが自動で弱点検出
3. 「弱点ドリル生成」ボタンをクリック
4. 跳躍進行に特化した5つのドリルが出現
5. 段階的に練習して克服
```

---

### 6.3 上級学習者・創作者

**現在の課題**:
- 作曲のインスピレーションが欲しい
- AIに頼りすぎず、協働したい
- 完成した曲をDAWで仕上げたい

**MIDI-LLM統合後の解決**:
- ✅ AI作曲アシスタントで対話的に創作
- ✅ 部分的な編集と再生成の繰り返し
- ✅ MIDI形式で書き出し、DAWで完成

**具体的な使い方**:
```
1. 作曲アシスタントで「明るいジャズピアノ」と入力
2. 16小節の下敷きが生成される
3. 7-8小節目を選択「もっとスウィング感を」
4. その部分だけ再生成
5. 満足したらMIDI書き出し→DAWで仕上げ
```

---

## 7. 競合との差別化

### 7.1 既存の音楽AI生成サービス

| サービス | 特徴 | MUEDの差別化ポイント |
|---------|------|---------------------|
| **MuseNet（OpenAI）** | 長い楽曲生成 | ❌ 教育特化なし、編集不可 |
| **AIVA** | 映像音楽生成 | ❌ 学習メトリクス連動なし |
| **Suno AI** | 歌付き音楽生成 | ❌ 楽譜・MIDI非対応 |
| **Hookpad Aria** | 作曲支援 | 🟡 近いが、弱点ドリル非対応 |
| **MUED + MIDI-LLM** | **教育特化** | ✅ 学習進捗連動<br/>✅ パーソナライズドリル<br/>✅ 弱点自動検出<br/>✅ 教師・学習者の双方向 |

---

## 8. まとめ：ユーザーにとっての価値

### 8.1 短期的価値（Phase 1-2、3ヶ月以内）

| ユーザー | 得られる価値 |
|---------|------------|
| **教師** | ⏱️ 教材作成時間を83%削減<br/>🎯 音楽理論的に正確な楽譜<br/>💾 MIDI形式で二次利用可能 |
| **学習者** | 🎯 自分専用のパーソナライズドリル<br/>📈 弱点克服速度が20%向上<br/>🎵 楽しく効率的な練習 |
| **MUED運営** | 💰 OpenAI APIコスト削減（月1000生成以上で）<br/>🏆 音楽教育AIのリーダーポジション<br/>📢 「音楽専用AI」のブランディング |

---

### 8.2 長期的価値（Phase 3、6ヶ月以降）

| ビジョン | 実現する世界 |
|---------|------------|
| **創造的学習** | 学習者が「消費者」から「創造者」へ<br/>AIと協働して自分だけの楽曲を作る |
| **教師の専門性向上** | 教材作成の時間を削減し、<br/>1対1の指導時間に集中できる |
| **音楽教育の民主化** | 高品質な教材を誰でもアクセス可能に<br/>経済的障壁を下げる |

---

## 9. 次のステップ

### 今週の意思決定事項

1. **Phase 1のスコープ合意**
   - [ ] AI教材生成にMIDI-LLM選択肢を追加
   - [ ] デフォルトはOpenAI維持
   - [ ] Modal.com最小構成でデプロイ

2. **UIモックアップ承認**
   - [ ] ラジオボタン2つ追加のみ（最小変更）
   - [ ] フィードバックフォーム設計

3. **成功指標の合意**
   - [ ] MIDI-LLM選択率: 10-20%
   - [ ] 生成成功率: 95%以上
   - [ ] ユーザー満足度: 4.0/5.0以上

### 実装タスク（Phase 1、2-3週間）

**Week 1**:
- [ ] Modal.comアカウント作成
- [ ] MIDI-LLMモデルのダウンロード
- [ ] Modal上でvLLMデプロイ（最小構成）

**Week 2**:
- [ ] `/api/ai/materials`にMIDI-LLMルート追加
- [ ] `/dashboard/materials/new`のUI変更（ラジオボタン追加）
- [ ] midi2abc変換ライブラリ統合

**Week 3**:
- [ ] E2Eテスト
- [ ] ベータユーザー招待（教師10名）
- [ ] フィードバック収集・分析

---

**作成者**: Claude Code
**承認**: [承認者名]
**次回レビュー**: Phase 1完了時（3週間後）
