---

## 第◯節　MUED 開発計画（ドラフト）

### 1. 開発の前提・ゴール

**1-1. 現在の状態（2025 時点）**

* MUED_v2 の基盤機能（認証・予約・決済・ダッシュボード・AI教材生成）は概ね E2E / CI まで緑化済み。
* Next.js / React / TypeScript / Drizzle / Neon / Stripe / Clerk / OpenAI API を中核とするモダンスタックで構成。
* 現状の MUED は「AI付き汎用LMS」としては成立しているが、

  * 音楽制作特化（耳・制作ログ・構造）の思想が UI / ドメイン / ドキュメントにまだ十分反映されていない。
  * MUEDnote（制作ログ）／Ear Training／構造分析のラインは未実装、またはプロトタイプレベルに留まる。

**1-2. 本開発計画で達成するゴール**

1. MUED の思想（Difference / Note / Form）を、

   * ドキュメント
   * ドメインモデル
   * UI/UX
   * 機能ライン
     に一貫して反映する。
2. MUEDnote（制作・学習ログ）を MUED の最上位概念として実装し、
   **「耳・思考・構造」の成長を追跡できるプラットフォーム** にする。
3. Ear Training（Difference）、Structure Training（Form）の MVP を MUED 上に実装し、
   Echovna との連携を含めた実証に耐える状態まで持っていく。
4. β版リリース（限定ユーザー／関係者向け）までの道筋を明確化し、ClaudeCode のアーキテクトエージェントが
   段階的に実装・リファクタリングを進められる状態にする。

---

### 2. 全体ロードマップ（フェーズ構成）

期間は目安。実際には並列化可能な部分も含む。

* **Phase 0（〜1か月）**：思想・ドキュメント統合フェーズ
* **Phase 1（1〜3か月）**：MUEDnote（Note）の実装・既存機能との統合
* **Phase 2（3〜6か月）**：Ear Training（Difference）MVP 開発
* **Phase 3（6〜9か月）**：Structure Training（Form）MVP 開発
* **Phase 4（9〜12か月）**：Echovna連携・PoC・クローズドβリリース

---

### 3. フェーズ別 詳細計画

#### Phase 0：思想・ドキュメント統合（Difference / Note / Form のインストール）

**目的：**
今後の機能開発がバラバラにならないよう、MUED の上位概念をリポジトリに明示する。

**タスク：**

1. `/docs/PHILOSOPHY.md` の追加

   * Difference（耳）
   * Note（制作・学習ログ）
   * Form（構造）
     の3本柱と、それぞれが
   * 教材
   * レッスン
   * ログ
   * AI機能
     とどう結びつくかを明文化。

2. `/docs/architecture.md` の更新

   * ドメインモデルに以下の抽象概念を追加定義：

     * `Learner`, `Mentor`, `Lesson`, `Material` に加えて

       * `LogEntry`（MUEDnote）
       * `EarExercise`（Difference系教材）
       * `FormExercise`（構造系教材）
   * モジュール境界を再定義：

     * `core/lesson`
     * `core/material`
     * `core/log`（MUEDnote）
     * `modules/ear-training`
     * `modules/structure-training`

3. `/docs/roadmap.md` に Difference / Note / Form に沿った項目を追加

   * 「機能ごと」ではなく「3フレームごと」のロードマップに再編。

**Phase 0の完了条件：**

* PHILOSOPHY / architecture / roadmap の3文書が整合していること。
* ClaudeCode エージェントがドキュメントを参照して、
  「新機能がどのフレームに属するか」が判断できる状態になっていること。

---

#### Phase 1：MUEDnote（Note）基盤の実装

**目的：**
MUED 内のあらゆる行動（レッスン、教材利用、制作、耳トレ）を
「ログ＝資産」として残せる仕組みを提供する。

**機能要件：**

1. **LogEntry モデルの追加**

   * 主なフィールド：

     * `id`
     * `user_id`（学習者／メンターいずれも可）
     * `type`（`lesson`, `practice`, `creation`, `reflection`, `system` など）
     * `target_id`（対象レッスン／教材／作品 ID）
     * `content`（Markdown / JSON）
     * `ai_summary`（AI 要約）
     * `created_at`, `updated_at`
   * 将来的な拡張：`tags`, `emotion`, `difficulty` など。

2. **Log記録UI の提供**

   * 各レッスン詳細ページに「ノート」タブを追加。
   * 教材ページ（特に Ear / Structure 系）にも「気づき・判断」を書けるエリアを追加。
   * シンプルな Markdown エディタ＋AI要約ボタン。

3. **AI要約・再構造化機能**

   * OpenAI API で LogEntry を要約し、

     * 重要ポイント
     * 次回への改善点
     * キーワード
       に整理して `ai_summary` に保存。

4. **学習者用「マイノート」画面**

   * タイムライン形式で LogEntry を一覧表示。
   * フィルタ：期間・タイプ・対象・タグ。

**非機能要件：**

* 既存 DB スキーマ・マイグレーションとの整合性（Drizzle で管理）。
* LogEntry テーブルの増加によるパフォーマンス劣化を防ぐためのインデックス設計。
* ログはユーザーごとのプライバシーを前提に（デフォルト非公開）。

**Phase 1 の完了条件：**

* 学習者が **すべてのレッスン・教材に対してノートを残し、後から一覧で閲覧できる**状態。
* AI要約が最低限動作し、判断のメタ情報が保存できていること。

---

#### Phase 2：Ear Training（Difference）MVP 開発

**目的：**
「差分を聴く耳」を育てるためのミニマム構成を MUED 上で動かす。

**機能要件（MVP）：**

1. **EarExercise モデル**

   * `id`
   * `title`, `description`
   * `type`（EQ, balance, rhythm, pitch など）
   * `audio_a_url`, `audio_b_url`
   * `difference_metadata`（どこを何dB変えたか等）
   * `correct_answer`（例：`A`, `B`, `same`）
   * `difficulty`, `tags`

2. **再生・回答 UI**

   * A/B再生ボタン
   * 「どちらが〜？」形式の問題UI
   * 回答後にフィードバック（正解・解説・差分表示）。

3. **スコアリング＆ログ**

   * EarExercise ごとの正答率・回答履歴を保存。
   * 各回答を LogEntry として MUEDnote にも紐づける。
   * 「どこが聴き取りにくかったか」といった主観メモを任意入力可能に。

4. **教材生成パイプライン（簡易版）**

   * Sunoや既存素材、EQ処理済み音源などから運営側が
     バッチ的に EarExercise を登録できる管理画面（MVP では手動でOK）。
   * 将来的に自動生成パイプラインを接続できる前提の設計にする。

**Phase 2 の完了条件：**

* 最低 1〜2 系統（例：EQ差分 / バランス差分）の EarExercise が
  本番同等 UX で動作していること。
* 学習者が EarExercise を解く → 結果と気づきを MUEDnote に残す →
  「耳の成長」を振り返れるフローが成立していること。

---

#### Phase 3：Structure Training（Form）MVP 開発

**目的：**
曲やアレンジを「構造」で理解するためのトレーニング機能を MUED 上に実装する。

**機能要件（MVP）：**

1. **FormExercise モデル**

   * `id`
   * `audio_url` または `midi_url`
   * `structure_annotations`（セクション・コード・役割など）
   * 問題形式：

     * セクション順当て
     * コード機能の分類
     * 展開のパターン認識 など。

2. **構造可視化 UI**

   * 波形・ピアノロール・セクションブロック等、
     簡易的なビジュアライゼーション（MVPでは簡易な表示でも可）。
   * 回答後に「正解構造」を表示。

3. **AI構造解析の入口**

   * 単一曲について

     * セクション推定
     * おおまかな構成説明
       を返す簡易 API を用意。
   * 将来的な MIDI-LLM や高度な構造解析の“フック”となる抽象インターフェースを設計。

4. **日志との統合**

   * 学習者が

     * 「この展開が好き」
     * 「このコード進行が不自然に感じた」
       といった主観的な記述を LogEntry に残せるようにし、
       Structure Training と MUEDnote を連動させる。

**Phase 3 の完了条件：**

* Structure Training の最小セット（1〜2問題タイプ）が
  MUED上で安定動作していること。
* FormExercise の結果や気づきがログとして蓄積され、
  後から MUEDnote で振り返れること。

---

#### Phase 4：Echovna 連携・PoC・クローズドβ

**目的：**
物理空間（Echovna）と MUED を接続し、
「耳・判断・構造」を実際の制作・演奏に結びつける循環を検証する。

**タスク案：**

1. Echovna 側ワークフローの整理

   * レコーディング／練習／セッションのどのタイミングで MUED にデータを送るか定義。
   * 最低限の API エンドポイント設計（音源URL＋メタ情報）。

2. MUED 側インポート機能

   * Echovna から渡された音源・メタを

     * EarExercise 素材
     * StructureExercise 素材
     * MUEDnote の LogEntry
       に変換する処理。

3. テストユーザーによる PoC

   * 少数の学習者・プレイヤー・講師で
     「Echovnaで収録 → MUEDで解析・トレーニング → 戻って再収録」
     のループを試す。

4. クローズドβ

   * UI/UX を整え、

     * 音大関係者
     * 外部スクール
     * 一部プロダクション
       を対象に限定公開。

---

### 4. 技術アーキテクチャ指針（ClaudeCode アーキエージェント向け）

1. **モジュール分割の優先順位**

   * `core/*`：ユーザー・レッスン・教材・ログなどのドメイン
   * `modules/ear-training`：Difference 系機能
   * `modules/structure-training`：Form 系機能
   * `modules/integration/echovna`：外部連携

2. **API 設計方針**

   * 内部 API は「フロント直通」ではなく、
     UseCase / Service 層を経由する形で実装（責務分離）。
   * ログ関連はできるだけ副作用を分離し、
     既存機能に最小限の変更で差し込める形を目標とする。

3. **テスト・CI**

   * Phase ごとに

     * Unit
     * Integration
     * E2E（Playwright）
       を最低1ケースずつ追加していくこと。
   * 特に Ear / Form モジュールは“ドメインロジックのテスト”を厚めに。

---

### 5. リリースポリシー（MVP〜β）

* MUED の「哲学＋MUEDnote」が実装された時点（Phase 1 完了）で、
  **内部利用者向け α 版** とする。
* Ear / Structure の両 MVP が乗ったタイミング（Phase 3 完了）で
  **クローズドβ** を実施。
* Echovna 連携まで含んだループが一通り動いた時点で、
  **対外的なプレゼン・補助金報告・事例発信** に使える状態とみなす。

