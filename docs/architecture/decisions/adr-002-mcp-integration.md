# ADR-002: Model Context Protocol (MCP) によるAIサービス統合

**日付**: 2025-01-26
**ステータス**: 提案中
**決定者**: 木村 篤史（代表取締役）

## コンテキスト

### 現状の課題

1. **AI機能の分散と非統一性**
   - Python FastAPIサービスが独立して動作
   - Next.jsアプリとの統合が不完全
   - API仕様の非標準化

2. **スケーラビリティの制限**
   - モノリシック構造による水平スケーリングの困難
   - AI機能の独立したスケーリングが不可能
   - リソース使用の非効率性

3. **開発・保守の複雑性**
   - 複数のプロトコルとインターフェースの管理
   - ベンダーロックインのリスク
   - テストとデバッグの困難さ

### ビジネス要件

- 3年以内に年間経常収益1億円超の達成
- B2B向けホワイトラベルSaaS/API提供
- 月間アクティブユーザー1万人のサポート
- グローバル展開への対応

## 決定

**Model Context Protocol (MCP) を採用し、すべてのAI機能を標準化されたプロトコルで統合する。**

### 採用理由

1. **標準化による効率性**
   - 統一されたインターフェースによる開発効率の向上
   - プロトコルレベルでの相互運用性の保証
   - ドキュメント化と学習コストの削減

2. **ベンダー中立性**
   - OpenAI以外のAIプロバイダーへの切り替えが容易
   - 複数のAIサービスの並行利用が可能
   - 将来的な技術変更への柔軟な対応

3. **エンタープライズ対応**
   - セキュリティ機能の標準実装
   - 監視とロギングの統一
   - B2B向けAPI提供の簡素化

## 実装アプローチ

### アーキテクチャ構成

```
┌─────────────┐     ┌──────────────┐     ┌─────────────┐
│  Next.js    │────▶│ MCP Gateway  │────▶│ AI MCP      │
│  Client     │     │   (Lasso)    │     │  Server     │
└─────────────┘     └──────────────┘     └─────────────┘
                            │
                            ▼
                    ┌──────────────┐
                    │ Payment MCP  │
                    │   Server     │
                    └──────────────┘
```

### 主要コンポーネント

1. **MCP Gateway (Lasso)**
   - 中央集約型のルーティング
   - 認証・認可の統一管理
   - レート制限とキャッシング

2. **AI MCP Server**
   - 教材生成機能
   - メンターマッチング機能
   - 学習分析機能

3. **Payment MCP Server**
   - Stripe統合
   - サブスクリプション管理
   - 請求処理

## 結果と影響

### ポジティブな影響

1. **開発効率の向上**
   - 統一されたAPIによる開発速度40%向上（推定）
   - テスト自動化の簡素化
   - デバッグとトラブルシューティングの改善

2. **運用コストの削減**
   - インフラコスト30%削減（推定）
   - 保守工数の削減
   - 自動スケーリングの最適化

3. **ビジネス価値の向上**
   - B2B API提供の迅速化
   - 新機能追加の高速化
   - 国際展開への対応力向上

### ネガティブな影響とリスク

1. **初期投資コスト**
   - 実装期間: 3-4ヶ月
   - 学習コスト: 2-3週間
   - 移行コスト: 約200万円

2. **技術的リスク**
   - MCPエコシステムの成熟度
   - 既存システムとの互換性
   - パフォーマンスへの影響

3. **組織的影響**
   - 開発チームの再教育
   - 運用プロセスの変更
   - ドキュメントの更新

## 代替案の検討

### 案1: 現状維持（REST API）
- **メリット**: 追加投資不要、既存知識の活用
- **デメリット**: スケーラビリティの制限、統合の複雑性
- **却下理由**: 長期的な成長目標との不整合

### 案2: GraphQL統合
- **メリット**: 柔軟なクエリ、型安全性
- **デメリット**: 学習曲線、AI機能との相性
- **却下理由**: AI統合に特化していない

### 案3: gRPC採用
- **メリット**: 高性能、バイナリプロトコル
- **デメリット**: ブラウザサポート、複雑性
- **却下理由**: Web環境での制約

## 実装計画

### Phase 1: 準備（1ヶ月）
- MCP仕様の学習とプロトタイプ作成
- 既存APIの棚卸しと統合計画
- 開発環境の準備

### Phase 2: 実装（2ヶ月）
- MCP Gatewayの構築
- AI MCP Serverの実装
- 統合テストの実施

### Phase 3: 移行（1ヶ月）
- 段階的なロールアウト
- モニタリングと最適化
- ドキュメント整備

## 成功指標

### 技術指標
- APIレスポンス時間: < 200ms (現在450ms)
- エラー率: < 0.1% (現在0.5%)
- 可用性: > 99.9% (現在99.5%)

### ビジネス指標
- 新機能開発速度: 40%向上
- 運用コスト: 30%削減
- B2B契約数: 6ヶ月で2社以上

## 参考資料

- [Model Context Protocol Specification](https://modelcontextprotocol.io/specification)
- [MCP Integration Best Practices](https://docs.mcp.io/best-practices)
- [Lasso MCP Gateway Documentation](https://github.com/lasso/mcp-gateway)

## 承認

- [ ] 技術責任者
- [ ] 財務責任者
- [x] 代表取締役（木村 篤史）

## 更新履歴

- 2025-01-26: 初版作成