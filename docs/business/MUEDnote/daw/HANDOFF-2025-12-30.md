# DAW連携開発 引き継ぎメモ

**日付**: 2025-12-30
**ステータス**: PoC完了、本番実装待ち

---

## 1. 完了した作業

### PoC検証（全完了）

| DAW/技術 | 結果 | ドキュメント |
|---------|------|-------------|
| Ableton OSC | ✅ 成功 | [poc-ableton-osc.md](./poc-ableton-osc.md) |
| Pro Tools PTSL | ⚠️ 制限あり | [poc-protools-ptsl.md](./poc-protools-ptsl.md) |
| MIDI IAC | ✅ 成功 | [poc-midi-iac.md](./poc-midi-iac.md) |
| Digital Performer | 📋 資料収集 | [digital-performer-osc-reference.md](./digital-performer-osc-reference.md) |

### 重要な発見

1. **Pro Tools SDK制限**: フェーダー/プラグインパラメータのAPIが未実装（Avid側の制限）
2. **Ableton最有力**: OSC経由でミキシング操作のフルログ取得可能
3. **MIDI共通化**: IAC Driver経由で全DAW共通の演奏ログ取得可能
4. **DP有望**: OSCで「nearly-complete bindings」とのこと、受託事業（カラオケMIDI）連携で価値あり

### ドキュメント整理

- 旧 `muednote-daw-poc-report.md` → DAW/技術別に分割
- [muednote-daw-poc-overview.md](./muednote-daw-poc-overview.md): 比較概要
- [muednote-daw-full-scope.md](./muednote-daw-full-scope.md): 計画・ロードマップ

---

## 2. 現在のコード状態

### MUEDnote Hub (Swift macOS)

```
apps/muednote-hub-macos/Sources/MUEDnoteHub/
├── MUEDnoteHubApp.swift           # メインアプリ（MIDI統合済み）
├── Services/
│   ├── OSCReceiverService.swift   # Ableton OSC連携（実装済み）
│   └── MIDIReceiverService.swift  # CoreMIDI受信（実装済み、未コミット）
└── Views/
    └── MenuBarView.swift          # UI（MIDI表示対応済み）
```

**注意**: `MIDIReceiverService.swift` は git status で untracked になっている

### Pro Tools テストスクリプト

```
scripts/protools-poc/
├── PTSL.proto              # Avid SDK からコピー
├── PTSL_pb2.py             # 生成されたProtobuf
├── PTSL_pb2_grpc.py        # 生成されたgRPC
└── ptsl_test.py            # テストクライアント
```

---

## 3. 次のステップ（優先順）

### 高優先度

| タスク | 工数目安 | 備考 |
|-------|---------|------|
| MIDIReceiverService.swift をコミット | 10分 | 未コミットファイルあり |
| API送信実装（OSC） | 1-2日 | MUED APIへPOST |
| API送信実装（MIDI） | 1-2日 | 同上 |
| 収録中スキップ実装 | 0.5日 | DAW録音中はMIDIログ不要 |

### 中優先度

| タスク | 工数目安 | 備考 |
|-------|---------|------|
| Digital Performer PoC | 3-5日 | OSC接続テスト |
| ログ量最適化 | 2-3日 | CCデバウンス調整等 |
| maxParamsPerDevice増加 | 0.5日 | 8 → 16〜32 |

### 低優先度

| タスク | 備考 |
|-------|------|
| Pro Tools対応 | SDK制限により実用性低い |
| Logic Pro対応 | Smart Controls 12ノブ/タブ上限 |
| Cubase対応 | Quick Controls 8パラメータ上限 |

---

## 4. 技術メモ

### Ableton OSC

- ポート: 送信 11000、受信 11001
- AbletonOSC（Max for Live）が必要
- リスナーは不安定 → ポーリング方式採用（200ms間隔）

### MIDI IAC

- Audio MIDI Setup.app で IAC Driver を有効化
- DAW側で IAC Driver への MIDI Output 設定
- フィードバック防止: DAWの IAC Input Track をオフに

### Pro Tools PTSL

- gRPC (TCP port 31416)
- SDK: `/Users/kimny/Dropbox/_DevProjects/AVID_SDK/PTSL_SDK_CPP.2025.10.0.1232349/`
- GetTrackControlInfo (ID: 148) は "Not yet implemented"

---

## 5. リリース戦略（推奨）

```
v1.0: Ableton OSC + MIDI（ミキシング＋演奏ログ）
v1.1: Digital Performer対応（受託事業連携）
v2.0: 他DAW検討
```

Pro Toolsはターゲット外（SDK制限＋ユーザー層の抵抗感）

---

## 6. 追加考察（Pro Tools回避策）

### 6.1 Vienna Ensemble Pro 経由

**概要**: VEPはPro ToolsからAU/VSTプラグインをホストできるラッパー

**調査結果**:
- 最大512パラメータをホストDAWに公開（[KVR Forum](https://www.kvraudio.com/forum/viewtopic.php?t=364583)）
- DAWオートメーション or MIDI CC で制御可能
- **しかしOSC/APIは存在しない**

**結論**: ❌ ログ取得の突破口にならない

```
Pro Tools → VEP → AU/VST plugins
    ↓
  パラメータを「書く」ことはできる
  パラメータを「読む」APIがない
```

**備考**: AbletonからVEPを使う場合は、Ableton OSC経由でログ取得可能かも（未検証）

---

### 6.2 信号解析ログプラグイン（特別企画向け）

**概要**: EQ/Comp等の前後に挿入し、信号変化をログ化するAAXプラグイン

**既存の類似プラグイン**:
- [GainStage Pro](https://hertzinstruments.com/master-your-recording-levels-with-gainstage-pro/) - 信号レベル監視
- [Blue Cat Audio Analysis](https://www.bluecataudio.com/Products/Category_Analysis/) - スペクトラム解析

**アーキテクチャ案**:
```
Audio In
   │
   ▼
┌─────────────┐
│ MUEDnote    │──→ Log: pre-EQ level/spectrum
│ Logger (1)  │
└──────┬──────┘
       ▼
┌─────────────┐
│ FabFilter   │
│ Pro-Q       │
└──────┬──────┘
       ▼
┌─────────────┐
│ MUEDnote    │──→ Log: post-EQ (差分でEQ効果を推測)
│ Logger (2)  │
└──────┬──────┘
       ▼
  Fader Out
```

**取得可能 vs 不可能**:

| 取得可能 | 取得不可 |
|---------|---------|
| 信号レベル（RMS/Peak） | どのパラメータを動かしたか |
| スペクトラム変化 | EQの具体的なバンド設定 |
| ダイナミクス変化 | コンプのThreshold値 |
| 処理タイミング | ユーザーの意図 |

**ユースケース**:
- ✅ ミックスマスタークラス企画
- ✅ Before/After音変化の可視化
- ❌ 日常業務（挿入が面倒）
- ❌ パラメータ詳細ログ

**開発工数（概算）**:

| 項目 | 工数 |
|-----|------|
| JUCE環境構築 | 1-2日 |
| 基本メータリング | 3-5日 |
| ログ送信機能 | 2-3日 |
| AAX署名取得 | 1-2週間（Avid審査） |
| **合計** | **2-4週間** |

**技術リソース**:
- [JUCE Framework](https://github.com/juce-framework/JUCE) - AAX/VST/AU開発
- AAX署名: PACE Anti-Piracy経由（Avidから無料提供）

**結論**: 日常ログ取得には不向きだが、「プロエンジニアのミックスを完全記録」的な特別企画には使える可能性あり。

---

## 7. 関連リソース

- [AbletonOSC](https://github.com/ideoforms/AbletonOSC)
- [OSCKit](https://github.com/orchetect/OSCKit)
- [MIDIKit](https://github.com/orchetect/MIDIKit)
- [PTSL SDK](file:///Users/kimny/Dropbox/_DevProjects/AVID_SDK/PTSL_SDK_CPP.2025.10.0.1232349/)

---

*作成: Claude Code*
