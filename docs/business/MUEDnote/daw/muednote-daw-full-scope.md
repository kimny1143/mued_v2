# MUEDnote DAW連携 フルスコープ

**作成日**: 2025-12-29
**更新日**: 2025-12-30
**目的**: 「やりたいこと全部」を可視化し、リソース感を把握する

---

## 1. 機能マトリクス

| 機能 | Ableton (OSC) | MIDI (IAC共通) | Pro Tools (SDK) |
|------|---------------|----------------|-----------------|
| トラックVol/Pan | ✅ PoC完了 | - | ❌ SDK未実装 |
| エフェクトパラメータ | ✅ PoC完了 | - | ❌ SDK未実装 |
| インストゥルメントパラメータ | ⚠️ 制限あり | - | ❌ SDK未実装 |
| トランスポート状態 | ✅ PoC完了 | - | ✅ PoC完了 |
| Mute/Solo/Rec | ✅ PoC完了 | - | ✅ PoC完了 |
| ノート（音程・長さ） | - | ✅ PoC完了 | ✅ IAC経由 |
| ベロシティ | - | ✅ PoC完了 | ✅ IAC経由 |
| CC（モジュレーション等） | - | ✅ PoC完了 | ✅ IAC経由 |
| ペダル（サステイン等） | - | ✅ PoC完了 | ✅ IAC経由 |
| ピッチベンド | - | ✅ PoC完了 | ✅ IAC経由 |

**注**: Pro ToolsはフェーダーやプラグインパラメータのSDKが未実装のため、ミキシング操作ログは取得不可。

---

## 2. 実装フェーズ

### Phase 1: OSC版 ✅ PoC完了
**スコープ**: ミキシング・音作りのログ

| 項目 | 状態 | 工数 |
|-----|------|------|
| AbletonOSC連携 | ✅ PoC完了 | 済 |
| ポーリング検出 | ✅ PoC完了 | 済 |
| メニューバーアプリ | ✅ PoC完了 | 済 |
| API送信 | 🔜 本番実装 | 1-2日 |

詳細: [poc-ableton-osc.md](./poc-ableton-osc.md)

### Phase 2: MIDI版 ✅ PoC完了
**スコープ**: 演奏内容のログ

| 項目 | 状態 | 工数 |
|-----|------|------|
| CoreMIDI受信 | ✅ PoC完了 | 済 |
| IAC Driver設定 | ✅ PoC完了 | 済 |
| ノート/CC/ペダル解析 | ✅ PoC完了 | 済 |
| デバウンス処理 | ✅ PoC完了 | 済 |
| UI統合 | ✅ PoC完了 | 済 |
| ログ量最適化 | 🔜 本番実装 | 2-3日 |
| API送信 | 🔜 本番実装 | 1-2日 |

詳細: [poc-midi-iac.md](./poc-midi-iac.md)

### Phase 3: Pro Tools SDK ✅ PoC完了（制限事項あり）
**スコープ**: Pro Tools対応

| 項目 | 状態 | 備考 |
|-----|------|------|
| SDK調査 | ✅ PoC完了 | PTSL SDK 2025.10 |
| Python gRPCクライアント | ✅ PoC完了 | テスト用 |
| トランスポート状態 | ✅ 取得可能 | |
| トラック状態イベント | ✅ 取得可能 | Mute/Solo/Rec |
| **フェーダー/Vol** | ❌ **SDK未実装** | Avid側の制限 |
| **プラグインパラメータ** | ❌ **SDK未実装** | Avid側の制限 |
| MIDI演奏 | ✅ IAC経由 | 共通方式 |

詳細: [poc-protools-ptsl.md](./poc-protools-ptsl.md)

**結論**: Pro Toolsはミキシング操作ログ取得に不向き。MIDIと基本状態のみ対応可能。

### Phase 4: Digital Performer (新規)
**スコープ**: DP対応（カラオケMIDI制作連携）

| 項目 | 状態 | 工数目安 |
|-----|------|---------|
| OSC資料収集 | ✅ 完了 | 済 |
| OSC接続テスト | 🔜 | 1-2日 |
| パラメータ取得検証 | 🔜 | 2-3日 |
| 本番実装 | 🔜 | 3-5日 |
| **小計** | | **6-10日** |

詳細: [digital-performer-osc-reference.md](./digital-performer-osc-reference.md)

---

## 3. MIDIログ量問題

### 試算

| シナリオ | 1分あたり | 1時間セッション |
|---------|----------|-----------------|
| ゆっくり練習 | 60-120ノート | 3,600-7,200件 |
| 通常演奏 | 200-400ノート | 12,000-24,000件 |
| 速いパッセージ | 600-1000ノート | 36,000-60,000件 |
| + CC/ペダル | x1.5-2倍 | 最大120,000件 |

### 対策案

| 対策 | 効果 | 複雑度 |
|-----|------|--------|
| **サンプリング** | CC を 50ms間隔に間引き | 低 |
| **デルタ記録** | 変化時のみ記録 | 中 |
| **セクション単位集約** | 8小節ごとにサマリ化 | 高 |
| **録音中のみ取得** | Ableton録音状態を監視 | 中 |
| **ユーザー選択** | 取得対象を設定で選択 | 低 |

**推奨**:
1. CCはデルタ記録 + 50msサンプリング
2. ノートは全取得（演奏内容は落としたくない）
3. 設定で「MIDIログ有効/無効」切替

---

## 4. アーキテクチャ比較

### 現状: OSCのみ
```
Ableton ─OSC→ MUEDnote Hub ─HTTP→ MUED API
```

### Phase 2: OSC + MIDI
```
Ableton ─OSC→ MUEDnote Hub ─HTTP→ MUED API
    │                │
    └─MIDI→ IAC ─────┘
```

### Phase 3: + Pro Tools
```
Ableton ──OSC──→ ┐
         MIDI──→ ├─ MUEDnote Hub ─HTTP→ MUED API
Pro Tools ─SDK─→ ┘
```

---

## 5. リソースサマリ

| フェーズ | PoC状態 | 本番残工数 | 提供価値 |
|---------|---------|-----------|---------|
| Phase 1 (OSC) | ✅ 完了 | 1-2日 | ミキシングログ |
| Phase 2 (MIDI) | ✅ 完了 | 3-5日 | 演奏ログ |
| Phase 3 (Pro Tools) | ✅ 完了（制限あり） | - | 基本状態のみ |
| Phase 4 (DP) | 📋 資料収集済み | 6-10日 | カラオケMIDI連携 |

**注**: Phase 3 (Pro Tools) はSDK制限により本番実装の優先度を下げる。Phase 4 (DP) は受託事業との連携で価値あり。

---

## 6. 推奨リリース戦略

### Option A: Ableton特化（推奨）
1. **v1.0**: Ableton OSC + MIDI（ミキシング＋演奏ログ）
2. **v1.1**: Digital Performer対応（受託事業連携）
3. **v2.0**: 他DAW検討（Logic Pro等）

**理由**:
- PoC結果よりAbletonが最も開放的なAPI
- Pro ToolsはSDK制限によりターゲット外
- DPは受託事業（カラオケMIDI制作）との連携で追加価値

### Option B: MIDI共通優先
1. **v1.0**: MIDI（IAC Driver）のみ - 全DAW共通
2. **v1.1**: Ableton OSC追加
3. **v2.0**: Digital Performer OSC追加

**理由**: MIDI演奏ログはDAW非依存で実装可能

### ~~Option C: Pro Tools対応~~（非推奨）
- SDK制限により実用的なミキシングログ取得不可
- ターゲットユーザー（プロエンジニア）のログ公開への抵抗感

---

## 7. 未解決事項

| 項目 | 検討ポイント | 優先度 |
|-----|-------------|--------|
| ログ保持期間 | 1ヶ月？3ヶ月？容量課金？ | 高 |
| オフライン対応 | ネット断時のローカルキュー | 中 |
| マルチトラックMIDI | トラック別にMIDI取得？ | 低 |
| 既存MIDI機器 | コントローラーからの入力も取得？ | 低 |
| 収録中スキップ | DAW録音中はMIDIログ不要（DAWが記録） | 高 |
| サードパーティインストゥルメント | On/Offのみ（Ableton API制限） | 情報 |
| DP OSC検証 | 実機での動作確認が必要 | 中 |

---

## 変更履歴

| 日付 | 変更内容 |
|-----|---------|
| 2025-12-29 | 初版作成 |
| 2025-12-30 | PoC結果反映、Phase 4 (DP) 追加、リリース戦略更新 |
