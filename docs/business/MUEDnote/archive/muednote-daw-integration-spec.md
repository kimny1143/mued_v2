# MUEDnote DAW連携機能 設計仕様書

## 概要

MUEDnoteの休憩トラッカー機能と連携し、DAW（Digital Audio Workstation）の作業状態を自動記録する機能。ユーザーの作業パターンや癖を可視化し、振り返りや教育用途に活用する。

## 対象ユーザー

### ミックスエンジニア
- 100トラック規模のセッションでプラグイン操作を行う
- 「なぜこの順番で処理したか」の思考プロセスを記録したい
- 弟子への教育コンテンツとして活用したい

### トラックメイカー・編曲家
- 自分の作業の振り返りに使いたい
- 「あのミックス、どうやって追い込んだっけ」を再現したい
- ジャンルごとの傾向分析

## 設計思想

### 基本方針
- **リアルタイム性は必須ではない** - 「今のEQ処理いいね」的な会話が目的ではない
- **パターン分析が目的** - 「いつもこういう癖あるよね」を発見する
- **既存機能への統合** - 休憩タイマーのタイミングを活用

### 重要な割り切り
- 全パラメータの常時監視は負荷的に非現実的
- DAWはパラメータ変更のプッシュ通知を提供しない（Ableton/Pro Tools共通の制約）
- スナップショット方式で十分な価値が出せる

---

## 動作モード

### 通常モード（MVP）

休憩タイマーと連動し、作業区切りごとに状態をキャプチャする。

```
セッション開始 → 初期スナップショット取得
    ↓
作業（25分など）
    ↓
休憩開始 → スナップショット取得 + ボイスメモ文字起こし
    ↓
差分計算：「この25分で何が変わったか」
```

#### 取得タイミング
- セッション開始時（初期状態）
- 休憩タイマー発火時
- セッション保存時
- セッション終了時

#### 取得データ
- トラック構成（名前、種類、数）
- プラグイン構成（どのトラックに何が刺さっているか）
- フェーダー位置（Volume/Pan）
- Mute/Solo/Record状態
- クリップ配置・フェード情報
- 編集モード・ツール状態

#### 負荷
- ほぼゼロ（25分に1回程度のAPI呼び出し）

#### 出力イメージ
```json
{
  "timestamp": "2025-01-07T14:30:00",
  "session_name": "ClientA_Mix_v3",
  "snapshot_type": "break_timer",
  "voice_memo_transcript": "ボーカルのEQ処理完了、次はコンプ調整",
  "changes_from_previous": {
    "plugins_added": ["Pro-Q 4 on Vocal", "Pro-C 2 on Vocal"],
    "fader_changes": [{"track": "Vocal", "volume_delta": -2.3}],
    "clips_modified": 3
  }
}
```

---

### フルログモード（オプトイン）

ユーザーが明示的にONにした場合のみ、詳細な時系列ログを取得する。

#### ユースケース
- 「今日のミックス作業は全部ログ取りたい」
- 教材作成用の詳細記録
- 自分の作業プロセスの深掘り分析

#### 取得方法
- ポーリング方式（500ms〜1s間隔）
- アクティブトラック（選択中/表示中）に絞って負荷軽減

#### 取得データ
- 通常モードの全項目
- パラメータ値の時系列変化
- より細かい操作タイムスタンプ

#### 負荷
- 中〜高（ポーリング間隔とトラック数に依存）

---

## 対応DAW

### Ableton Live（優先）

#### 技術スタック
- AbletonOSC（https://github.com/ideoforms/AbletonOSC）
- OSC over UDP
- Protokolで動作確認済み

#### 取得可能なデータ
- トラック情報（名前、種類、ボリューム、パン、ミュート、ソロ）
- デバイス（プラグイン）情報
- クリップ情報
- トランスポート状態

#### 制約事項
- サードパーティプラグイン（FabFilter等）のパラメータは取得可能だが、パラメータ名が汎用的（"Param 1"等）になる場合がある
- VST仕様の128パラメータ上限
- パラメータ変更のプッシュ通知なし（ポーリング必要）

---

### Pro Tools（将来対応）

#### 技術スタック
- Pro Tools Scripting SDK 2025.10
- gRPC over localhost:31416
- C++リファレンス実装あり（Python/Node.js等でも利用可能）

#### 取得可能なデータ

**イベント通知あり（リアルタイム）**
- セッション開閉（EId_SessionOpened, EId_SessionClosed）
- トラックMute/Solo/Record状態変更
- カスタムメニュー選択

**ポーリングで取得**
- トラック情報（GetTrackList）
- プラグインパラメータ（GetTrackControlInfo）
- クリップ情報（GetClipList, GetPlaylistElements）
- フェード情報（FadeInfo）
- 編集モード・ツール状態

#### 制約事項
- プラグインパラメータ変更のイベント通知なし
- ローカル接続のみ（リモート非対応）
- 開発者登録が必要（無料）

#### SDK取得先
- https://developer.avid.com/scripting/
- Avid Developer Account必要

---

## 技術的詳細

### サードパーティプラグイン対応

FabFilter、Waves等のサードパーティプラグインについて：

#### 取得できるもの
- オートメーション可能なパラメータの現在値
- Freq、Gain、Q、Ratio等の主要パラメータ

#### 取得できないもの
- プラグインGUI内部の操作
- プリセット切り替え（プラグイン内部処理）
- 128パラメータを超える部分

#### 対応方針
- Device名 +「パラメータ変更あり」レベルの粒度で十分
- 詳細なパラメータ名マッピングは将来課題

### バーチャルインストゥルメント対応

Kontakt、Omnisphere等のVI：

#### 取得できるもの
- ボリューム、パン、フィルター等のオートメーション可能パラメータ

#### 取得できないもの
- VI内部でのライブラリ切り替え
- プリセットブラウジング
- VI固有のGUI操作

---

## 開発ロードマップ

### Phase 1: Ableton通常モード（MVP）
1. AbletonOSC接続の安定化
2. スナップショット取得機能の実装
3. 休憩タイマーとの統合
4. 差分計算ロジック

### Phase 2: ユーザー検証
- MVP公開
- 実際の作業フローでの使用感確認
- 必要データの過不足フィードバック

### Phase 3: フルログモード追加
- ポーリング機能の実装
- 負荷調整（間隔、対象トラック絞り込み）
- UIでのON/OFF切り替え

### Phase 4: Pro Tools対応
- Scripting SDK統合
- イベント通知の活用
- Ableton版との共通インターフェース設計

---

## 出力データ活用

### 癖の分析例
- 「ボーカルには必ず最初にディエッサーを挿す」
- 「キックのコンプはアタック10-30msの範囲が多い」
- 「EQ → COMP → EQの順番が多い」
- 「このジャンルではこのプラグインをよく使う」

### ボイスメモとの連携
休憩時のボイスメモと状態スナップショットが紐づくことで：
- 「ボーカル処理やってた」+ 実際の変更内容
- 意図と結果のマッピング
- 作業密度の可視化（25分で何が進んだか）

---

## 参考資料

### Ableton
- AbletonOSC: https://github.com/ideoforms/AbletonOSC
- Protokol（OSCモニタリングツール）

### Pro Tools
- Pro Tools Scripting SDK: https://developer.avid.com/scripting/
- SoundFlow SFX Framework（参考実装）: https://soundflow.org/sfx

---

## 更新履歴

| 日付 | 内容 |
|------|------|
| 2025-12-29 | 初版作成。Ableton OSC POC中、Pro Tools SDK調査完了 |
