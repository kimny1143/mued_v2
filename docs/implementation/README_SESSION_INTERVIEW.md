# MUEDnote Session/Interview 機能実装ドキュメント群

**作成日**: 2025-11-19
**バージョン**: 1.0.0
**ステータス**: 実装計画完成

---

## ドキュメント概要

このディレクトリには、MUEDnote の Session/Interview 機能を実装するための包括的なドキュメント群が含まれています。

### 対象読者

- プロジェクトマネージャー（進捗管理・リスク管理）
- アーキテクト（システム設計・技術選定）
- バックエンド開発者（API・Service・Repository実装）
- フロントエンド開発者（UI/UXコンポーネント実装）
- QAエンジニア（テスト計画・品質保証）

---

## ドキュメント一覧

### 1. メイン実装計画書

**ファイル**: `MUEDNOTE_SESSION_INTERVIEW_IMPLEMENTATION_PLAN.md` (52KB)

**内容**:
- エグゼクティブサマリー
- システムアーキテクチャ設計（データフロー図含む）
- データベーススキーマ設計（sessions, interview_questions, interview_answers, rag_embeddings）
- API設計（全エンドポイント仕様）
- Service層設計（AnalyzerService, InterviewerService, RAGService）
- Repository層設計
- コンポーネント設計（React/TypeScript）
- 既存コードとの統合戦略
- マイルストーン定義（Phase 1.2, 1.3, 1.4）
- リスク管理
- 成功指標（KPI）

**主要な読者**: 全員（特にプロジェクトマネージャー、アーキテクト）

**推奨読了時間**: 60-90分

---

### 2. アーキテクチャ図解集

**ファイル**: `MUEDNOTE_SESSION_ARCHITECTURE_DIAGRAMS.md` (46KB)

**内容**:
- レイヤー別アーキテクチャ図（ASCII）
- Session作成フローの詳細シーケンス図
- 回答フローの詳細シーケンス図
- ER図（データモデル関連図）
- Session状態遷移図
- UIコンポーネント階層構造
- API呼び出しフロー
- パフォーマンス最適化戦略
  - キャッシング戦略
  - インデックス戦略
  - N+1クエリ回避
- エラーハンドリング戦略
- セキュリティ考慮事項

**主要な読者**: アーキテクト、バックエンド開発者、フロントエンド開発者

**推奨読了時間**: 45-60分

---

### 3. 移行ガイド

**ファイル**: `MUEDNOTE_MIGRATION_GUIDE.md` (26KB)

**内容**:
- 移行フェーズ概要（Phase 1-3）
- データベースマイグレーション
  - 5つのマイグレーションファイル詳細
  - 実行手順（ローカル→開発→本番）
- バックエンド移行戦略
  - Repository層の段階的移行
  - Service層の拡張
  - API Routesの段階的移行
- フロントエンド移行戦略
  - コンポーネント追加（既存維持）
  - UIの段階的切り替え（タブ→デフォルト変更→完全移行）
- データ移行スクリプト
  - 既存ログのSessionへのグループ化ロジック
  - 実行手順
- テスト戦略
  - 後方互換性テスト
  - Session統合テスト
  - E2Eテスト
- ロールバック計画
- 監視とアラート設定
- チェックリスト
- FAQ

**主要な読者**: バックエンド開発者、DevOps、QAエンジニア

**推奨読了時間**: 45-60分

---

### 4. Phase 1 実装計画（既存）

**ファイル**: `MUEDNOTE_PHASE1_IMPLEMENTATION_PLAN.md` (18KB)

**内容**:
- Phase 1.0: MVP基盤構築（2週間）
- Phase 1.1: AI人格システム（2週間）
- Phase 1.2: 高度なインタラクション（2週間）
- Phase 1.3: 商用化準備（2週間）
- 日次タスクブレークダウン

**主要な読者**: プロジェクトマネージャー、開発チーム全員

**推奨読了時間**: 30-45分

---

## ドキュメント間の関連性

```
                 ┌─────────────────────────────┐
                 │  実装計画書（メイン）         │
                 │  - 全体戦略                  │
                 │  - マイルストーン            │
                 │  - リスク管理                │
                 └─────────────────────────────┘
                            │
                ┌───────────┼───────────┐
                │           │           │
                ↓           ↓           ↓
    ┌─────────────────┐ ┌─────────────────┐ ┌─────────────────┐
    │ アーキテクチャ   │ │ 移行ガイド       │ │ Phase 1計画     │
    │ 図解集           │ │                 │ │                 │
    │ - 技術詳細       │ │ - 実行手順       │ │ - タイムライン   │
    │ - 最適化戦略     │ │ - データ移行     │ │ - タスク詳細     │
    └─────────────────┘ └─────────────────┘ └─────────────────┘
            │                     │                     │
            └─────────────────────┴─────────────────────┘
                            │
                            ↓
                  ┌─────────────────┐
                  │   実装作業       │
                  │ - コーディング   │
                  │ - テスト         │
                  │ - デプロイ       │
                  └─────────────────┘
```

---

## 読む順番の推奨

### 初めて読む場合（全体把握）

1. **実装計画書** の「エグゼクティブサマリー」（10分）
2. **アーキテクチャ図解集** の「全体構成図」と「Session作成フロー」（15分）
3. **移行ガイド** の「移行フェーズ概要」（10分）
4. **Phase 1計画** の「マイルストーン定義」（10分）

**合計**: 約45分で全体像が把握できます。

### プロジェクトマネージャー向け

1. 実装計画書 - エグゼクティブサマリー
2. 実装計画書 - マイルストーン定義
3. 実装計画書 - リスク管理
4. 実装計画書 - 成功指標（KPI）
5. Phase 1計画 - 日次タスクブレークダウン
6. 移行ガイド - チェックリスト

### アーキテクト向け

1. 実装計画書 - システムアーキテクチャ設計
2. アーキテクチャ図解集 - 全セクション
3. 実装計画書 - データベーススキーマ設計
4. 実装計画書 - 既存コードとの統合戦略

### バックエンド開発者向け

1. アーキテクチャ図解集 - データフロー図
2. 実装計画書 - データベーススキーマ設計
3. 実装計画書 - API設計
4. 実装計画書 - Service層設計
5. 実装計画書 - Repository層設計
6. 移行ガイド - バックエンド移行戦略
7. 移行ガイド - データ移行スクリプト

### フロントエンド開発者向け

1. アーキテクチャ図解集 - UIコンポーネント階層
2. 実装計画書 - コンポーネント設計
3. 実装計画書 - API設計（エンドポイント仕様）
4. 移行ガイド - フロントエンド移行戦略
5. アーキテクチャ図解集 - コンポーネント責務マトリックス

### QAエンジニア向け

1. 実装計画書 - 成功指標（KPI）
2. 移行ガイド - テスト戦略
3. 移行ガイド - チェックリスト
4. アーキテクチャ図解集 - エラーハンドリング戦略
5. 移行ガイド - 監視とアラート

---

## 重要な概念・用語集

### Session（セッション）

制作・学習活動の単位。ユーザーが「今日サビのコード進行を調整した」のような1つの作業セッションを表す。

**主要フィールド**:
- `type`: composition, practice, mix など
- `userShortNote`: ユーザーが書いた1〜2行のメモ
- `aiAnnotations`: AI分析結果（focusArea, intentHypothesis）

### Analyzer（アナライザー）

ユーザーの短文メモを分析し、以下を推定するAI:
- **focusArea**: 音楽的焦点領域（harmony, melody, rhythm, mix等）
- **intentHypothesis**: 制作意図（「サビを落ち着かせようとしている」等）

**MVP版**: テキストベースの推定
**将来版**: MIDI/WAV差分解析

### Interviewer（インタビュアー）

Session の分析結果とRAGコンテキストを基に、2〜3問の質問を生成するAI。

**特徴**:
- 理論用語を避け、「感触」「比喩」で答えられる質問
- Session に紐づく具体的な変化を基準
- 友好的なトーン

### RAG（Retrieval-Augmented Generation）

過去のログや質問テンプレートを検索し、Interviewerに文脈を提供する仕組み。

**技術**:
- OpenAI Embeddings (text-embedding-ada-002)
- PostgreSQL pgvector拡張
- コサイン類似度検索

### 移行フェーズ

**Phase 1（並行運用）**: 既存機能維持 + 新テーブル追加
**Phase 2（Session優先）**: 新規ログは必ずSessionに紐付け
**Phase 3（完全統合）**: 既存ログをSessionにマッピング

---

## 技術スタック概要

| レイヤー | 技術 |
|---------|------|
| **Frontend** | Next.js 15.5.4, React 19, TailwindCSS 4 |
| **Backend** | Next.js API Routes, Drizzle ORM |
| **Database** | Neon PostgreSQL + pgvector拡張 |
| **Auth** | Clerk |
| **AI** | OpenAI GPT-5系（本番）/ Claude Sonnet 4.5（開発） |
| **Embeddings** | OpenAI text-embedding-ada-002 |
| **Testing** | Vitest（Unit）, Playwright（E2E） |
| **Deployment** | Vercel |

---

## マイルストーン一覧

### Phase 1.2: Session基盤構築（Week 1-2）

**成果物**:
- sessions, interview_questions, interview_answers テーブル作成完了
- SessionRepository, InterviewRepository 実装完了
- AnalyzerService（MVP版）実装完了
- POST /api/sessions, GET /api/sessions API動作

### Phase 1.3: Interview機能実装（Week 3-4）

**成果物**:
- InterviewerService 実装完了
- RAGService 実装完了（pgvector統合）
- POST /api/interview/questions, POST /api/interview/answers API動作
- Session作成→Analyzer→Interview フロー動作

### Phase 1.4: UI統合（Week 5-6）

**成果物**:
- SessionList, CreateSessionModal コンポーネント実装完了
- InterviewPanel, QuestionCard コンポーネント実装完了
- タイムライン表示のSession対応完了
- E2Eテスト全パス

---

## 次のアクション

### 今週中（Week 1: 11/25-29）

**優先度: 高**

1. **データベーススキーマ作成**
   - [ ] `db/schema/sessions.ts` 作成
   - [ ] `db/schema/interviews.ts` 作成
   - [ ] マイグレーションファイル生成
   - [ ] ローカルDBに適用

2. **Repository層実装**
   - [ ] `SessionRepository` 作成
   - [ ] `InterviewQuestionRepository` 作成
   - [ ] `InterviewAnswerRepository` 作成
   - [ ] ユニットテスト作成

3. **AnalyzerService基礎実装**
   - [ ] MVP版プロンプト設計
   - [ ] テキスト分析ロジック実装
   - [ ] フォールバック処理実装

**担当者**: バックエンド開発者
**レビュー**: Week 1終了時（11/29金曜日）

---

## 連絡先・質問

### ドキュメントに関する質問

- プロジェクトマネージャー: [連絡先]
- テックリード: [連絡先]

### 実装に関する質問

- バックエンド: [連絡先]
- フロントエンド: [連絡先]
- QA: [連絡先]

---

## 改訂履歴

| 日付 | バージョン | 変更内容 | 担当者 |
|------|-----------|---------|--------|
| 2025-11-19 | 1.0.0 | 初版作成 | Claude Code |

---

## ライセンス・著作権

本ドキュメント群は MUED プロジェクトの内部資料です。無断転載・複製を禁じます。

---

**ドキュメント群の総ページ数**: 約140ページ相当
**推定総読了時間**: 3-4時間

このドキュメント群を活用することで、Session/Interview機能の実装を計画的かつ確実に進めることができます。
