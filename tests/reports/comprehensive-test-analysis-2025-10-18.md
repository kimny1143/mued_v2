# MUED LMS v2 åŒ…æ‹¬çš„ãƒ†ã‚¹ãƒˆç’°å¢ƒåˆ†æå ±å‘Šæ›¸

**ä½œæˆæ—¥**: 2025å¹´10æœˆ18æ—¥
**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ**: MUED LMS v2 - éŸ³æ¥½æ•™è‚²ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ 
**åˆ†æè€…**: Claude Code Test Architect

---

## 1. ã‚¨ã‚°ã‚¼ã‚¯ãƒ†ã‚£ãƒ–ã‚µãƒãƒªãƒ¼

MUED LMS v2ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®ãƒ†ã‚¹ãƒˆç’°å¢ƒã‚’åŒ…æ‹¬çš„ã«åˆ†æã—ãŸçµæœã€ä»¥ä¸‹ã®ä¸»è¦ãªç™ºè¦‹äº‹é …ã‚’å ±å‘Šã—ã¾ã™ï¼š

### ç¾çŠ¶è©•ä¾¡
- **ãƒ†ã‚¹ãƒˆåŸºç›¤**: Vitestï¼ˆãƒ¦ãƒ‹ãƒƒãƒˆï¼‰ã¨Playwrightï¼ˆE2Eï¼‰ã®é©åˆ‡ãªè¨­å®šãŒæ•´å‚™æ¸ˆã¿
- **ãƒ¢ãƒƒã‚¯æˆ¦ç•¥**: OpenAIã€Stripeã€Clerkã«å¯¾ã™ã‚‹åŒ…æ‹¬çš„ãªãƒ¢ãƒƒã‚¯ãŒå®Ÿè£…æ¸ˆã¿
- **ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸**: å®Ÿéš›ã®ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã«å¯¾ã™ã‚‹ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒ**ä¸è¶³**ï¼ˆ0%ã‚«ãƒãƒ¬ãƒƒã‚¸ï¼‰
- **E2Eãƒ†ã‚¹ãƒˆ**: åŸºæœ¬çš„ãªèªè¨¼ãƒ•ãƒ­ãƒ¼ã¨ãƒšãƒ¼ã‚¸é·ç§»ã¯å®Ÿè£…æ¸ˆã¿ã€æ©Ÿèƒ½ãƒ†ã‚¹ãƒˆãŒä¸è¶³

### é‡è¦ãªèª²é¡Œ
1. **ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®å®Œå…¨ãªæ¬ å¦‚**: `lib/`ã¨`app/`ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã«`.test.ts`ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„
2. **çµ±åˆãƒ†ã‚¹ãƒˆã®æœªå®Ÿè£…**: APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®å®Ÿéš›ã®ãƒ†ã‚¹ãƒˆå®Ÿè£…ãŒä¸è¶³
3. **AIæ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆæ¬ å¦‚**: OpenAI Function Callingã®å®Ÿè£…ã«å¯¾ã™ã‚‹ãƒ†ã‚¹ãƒˆãŒãªã„
4. **æ±ºæ¸ˆãƒ•ãƒ­ãƒ¼ã®æœªãƒ†ã‚¹ãƒˆ**: Stripeçµ±åˆã®å®Ÿéš›ã®å‹•ä½œæ¤œè¨¼ãŒä¸ååˆ†

---

## 2. ãƒ†ã‚¹ãƒˆç’°å¢ƒæ§‹æˆã®è©³ç´°åˆ†æ

### 2.1 Vitestè¨­å®šï¼ˆãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆï¼‰

**è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**: `/vitest.config.ts`

#### å¼·ã¿
âœ… JSDoMç’°å¢ƒã®é©åˆ‡ãªè¨­å®š
âœ… ã‚«ãƒãƒ¬ãƒƒã‚¸é–¾å€¤ã®è¨­å®šï¼ˆ70%ï¼‰
âœ… ä¸¦åˆ—å®Ÿè¡Œã®æœ‰åŠ¹åŒ–
âœ… HTMLãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆã®è¨­å®š

#### èª²é¡Œ
âŒ å®Ÿéš›ã®ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„
âŒ ã‚«ãƒãƒ¬ãƒƒã‚¸é–¾å€¤ã‚’æº€ãŸã™ãƒ†ã‚¹ãƒˆãŒãªã„
âŒ ãƒ¢ãƒƒã‚¯ã®ãƒªã‚»ãƒƒãƒˆæˆ¦ç•¥ãŒä¸å®Œå…¨

### 2.2 Playwrightè¨­å®šï¼ˆE2Eãƒ†ã‚¹ãƒˆï¼‰

**è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«**: `/playwright.config.ts`

#### å¼·ã¿
âœ… é©åˆ‡ãªã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®š
âœ… ãƒ“ãƒ‡ã‚ªãƒ»ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã‚·ãƒ§ãƒƒãƒˆè¨˜éŒ²
âœ… ãƒ†ã‚¹ãƒˆå¤±æ•—æ™‚ã®ãƒªãƒˆãƒ©ã‚¤è¨­å®š

#### èª²é¡Œ
âŒ ä¸¦åˆ—å®Ÿè¡ŒãŒç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã‚‹ï¼ˆèªè¨¼ã®å®‰å®šæ€§ã®ãŸã‚ï¼‰
âŒ Chromiumã®ã¿ã§ã®ãƒ†ã‚¹ãƒˆï¼ˆFirefoxã€WebKitæœªå¯¾å¿œï¼‰
âŒ E2Eãƒ†ã‚¹ãƒˆãƒ¢ãƒ¼ãƒ‰ã®ç’°å¢ƒå¤‰æ•°è¨­å®šãŒä¸å®Œå…¨

---

## 3. æ—¢å­˜ãƒ†ã‚¹ãƒˆã®è©•ä¾¡

### 3.1 ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«åˆ†å¸ƒ

```
tests/
â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ lib/
â”‚   â”‚   â”œâ”€â”€ openai.test.ts (ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã¿)
â”‚   â”‚   â”œâ”€â”€ ai/tools.test.ts (ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã¿)
â”‚   â”‚   â””â”€â”€ matching-algorithm.test.ts (æœªç¢ºèª)
â”‚   â””â”€â”€ (ä»–ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãªã—)
â”œâ”€â”€ integration/
â”‚   â””â”€â”€ api/
â”‚       â””â”€â”€ ai-intent.test.ts (ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã®ã¿)
â”œâ”€â”€ e2e/
â”‚   â”œâ”€â”€ api-endpoints.spec.ts (åŸºæœ¬çš„ãªAPIãƒ†ã‚¹ãƒˆ)
â”‚   â””â”€â”€ subscription.spec.ts (èªè¨¼ãƒã‚§ãƒƒã‚¯ã®ã¿)
â”œâ”€â”€ mocks/
â”‚   â”œâ”€â”€ openai.mock.ts (åŒ…æ‹¬çš„ãªãƒ¢ãƒƒã‚¯å®Ÿè£…)
â”‚   â””â”€â”€ stripe.mock.ts (åŒ…æ‹¬çš„ãªãƒ¢ãƒƒã‚¯å®Ÿè£…)
â””â”€â”€ setup/
    â””â”€â”€ vitest.setup.ts (ã‚°ãƒ­ãƒ¼ãƒãƒ«è¨­å®š)
```

### 3.2 ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸è©•ä¾¡

| ã‚«ãƒ†ã‚´ãƒª | ãƒ•ã‚¡ã‚¤ãƒ«æ•° | ãƒ†ã‚¹ãƒˆæ¸ˆã¿ | ã‚«ãƒãƒ¬ãƒƒã‚¸ |
|---------|-----------|------------|------------|
| **APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ** | 12 | 2 | 16.7% |
| **ãƒšãƒ¼ã‚¸ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ** | 11 | 0 | 0% |
| **ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯** | 6 | 0 | 0% |
| **UIã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ** | ä¸æ˜ | 0 | 0% |
| **ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£** | ä¸æ˜ | 0 | 0% |

**æ¨å®šç·åˆã‚«ãƒãƒ¬ãƒƒã‚¸**: **5-10%**

---

## 4. ãƒ†ã‚¹ãƒˆã‚®ãƒ£ãƒƒãƒ—åˆ†æ

### 4.1 å„ªå…ˆåº¦ï¼šæœ€é«˜ ğŸ”´

#### OpenAI Function Callingæ©Ÿèƒ½
- **æœªãƒ†ã‚¹ãƒˆæ©Ÿèƒ½**:
  - `searchAvailableSlots` - ãƒ¬ãƒƒã‚¹ãƒ³æ¤œç´¢
  - `createReservation` - äºˆç´„ä½œæˆ
  - `generateStudyMaterial` - AIæ•™æç”Ÿæˆ
  - `getSubscriptionStatus` - ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ç¢ºèª
  - `upgradeSubscription` - ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰å‡¦ç†

#### Stripeæ±ºæ¸ˆãƒ•ãƒ­ãƒ¼
- **æœªãƒ†ã‚¹ãƒˆæ©Ÿèƒ½**:
  - ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆã‚»ãƒƒã‚·ãƒ§ãƒ³ä½œæˆ
  - Webhookå‡¦ç†ï¼ˆ`customer.subscription.created`ç­‰ï¼‰
  - ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³åˆ¶é™ã®é©ç”¨
  - æ±ºæ¸ˆå¤±æ•—æ™‚ã®ãƒªãƒˆãƒ©ã‚¤

#### èªè¨¼ãƒ»èªå¯
- **æœªãƒ†ã‚¹ãƒˆæ©Ÿèƒ½**:
  - ClerkãƒŸãƒ‰ãƒ«ã‚¦ã‚§ã‚¢ã®å‹•ä½œ
  - ãƒ­ãƒ¼ãƒ«ãƒ™ãƒ¼ã‚¹ã‚¢ã‚¯ã‚»ã‚¹åˆ¶å¾¡
  - ãƒˆãƒ¼ã‚¯ãƒ³ã®æœ‰åŠ¹æœŸé™å‡¦ç†

### 4.2 å„ªå…ˆåº¦ï¼šé«˜ ğŸŸ 

#### AIæ•™æç”Ÿæˆã‚µãƒ¼ãƒ“ã‚¹
- **æœªãƒ†ã‚¹ãƒˆæ©Ÿèƒ½**:
  - ä½¿ç”¨åˆ¶é™ã®é©ç”¨ï¼ˆæœˆé–“ç”Ÿæˆæ•°ï¼‰
  - ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹
  - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ï¼ˆãƒ¬ãƒ¼ãƒˆåˆ¶é™ã€ã‚¯ã‚©ãƒ¼ã‚¿è¶…éï¼‰

#### äºˆç´„ã‚·ã‚¹ãƒ†ãƒ 
- **æœªãƒ†ã‚¹ãƒˆæ©Ÿèƒ½**:
  - ã‚¹ãƒ­ãƒƒãƒˆã®ãƒãƒƒãƒãƒ³ã‚°ã‚¢ãƒ«ã‚´ãƒªã‚ºãƒ 
  - é‡è¤‡äºˆç´„ã®é˜²æ­¢
  - ã‚­ãƒ£ãƒ³ã‚»ãƒ«å‡¦ç†

### 4.3 å„ªå…ˆåº¦ï¼šä¸­ ğŸŸ¡

#### ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰æ©Ÿèƒ½
- çµ±è¨ˆæƒ…å ±ã®è¡¨ç¤º
- ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ›´æ–°
- ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°ãƒ»ã‚½ãƒ¼ãƒˆ

---

## 5. ãƒ¢ãƒƒã‚¯æˆ¦ç•¥è©•ä¾¡

### 5.1 OpenAIãƒ¢ãƒƒã‚¯ (`openai.mock.ts`)

#### å¼·ã¿
âœ… Function Callingå¯¾å¿œ
âœ… ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ãƒ¬ã‚¹ãƒãƒ³ã‚¹å¯¾å¿œ
âœ… ã‚¨ãƒ©ãƒ¼ã‚·ãƒŠãƒªã‚ªã®ç¶²ç¾…

#### æ”¹å–„ç‚¹
- MSWï¼ˆMock Service Workerï¼‰ã¸ã®ç§»è¡Œæ¤œè¨
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹é…å»¶ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³è¿½åŠ 
- ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ã®ç²¾å¯†ãªè¨ˆç®—

### 5.2 Stripeãƒ¢ãƒƒã‚¯ (`stripe.mock.ts`)

#### å¼·ã¿
âœ… Webhookã‚¤ãƒ™ãƒ³ãƒˆã®åŒ…æ‹¬çš„ãƒ¢ãƒƒã‚¯
âœ… å…¨ä¸»è¦APIã®ãƒ¢ãƒƒã‚¯å®Ÿè£…

#### æ”¹å–„ç‚¹
- 3Dã‚»ã‚­ãƒ¥ã‚¢èªè¨¼ãƒ•ãƒ­ãƒ¼ã®ãƒ¢ãƒƒã‚¯
- éƒ¨åˆ†çš„ãªæ±ºæ¸ˆå¤±æ•—ã®ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³
- å›½éš›åŒ–å¯¾å¿œï¼ˆé€šè²¨ãƒ»ç¨é‡‘ï¼‰

---

## 6. ãƒ†ã‚¹ãƒˆå®Ÿè¡Œç’°å¢ƒã®å•é¡Œç‚¹

### ç™ºè¦‹ã•ã‚ŒãŸæŠ€è¡“çš„å•é¡Œ

1. **ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®é…ç½®å•é¡Œ**
   - Vitestã®è¨­å®šã§ã¯`lib/**/*.test.ts`ã‚’æœŸå¾…ã—ã¦ã„ã‚‹ãŒã€å®Ÿéš›ã®ãƒ†ã‚¹ãƒˆã¯`tests/unit/`ã«é…ç½®
   - è§£æ±ºç­–: ãƒ‘ã‚¹è¨­å®šã®ä¿®æ­£ã¾ãŸã¯ä¸€è²«ã—ãŸé…ç½®è¦å‰‡ã®æ¡ç”¨

2. **E2Eãƒ†ã‚¹ãƒˆã®èªè¨¼å•é¡Œ**
   - Clerkã®èªè¨¼ã«ã‚ˆã‚ŠE2Eãƒ†ã‚¹ãƒˆãŒä¸å®‰å®š
   - è§£æ±ºç­–: ãƒ†ã‚¹ãƒˆç”¨ã®èªè¨¼ãƒã‚¤ãƒ‘ã‚¹ãƒ¢ãƒ¼ãƒ‰ã®å®Ÿè£…

3. **ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹åˆ†é›¢ã®æ¬ å¦‚**
   - ãƒ†ã‚¹ãƒˆç”¨ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è¨­å®šãŒä¸æ˜ç¢º
   - è§£æ±ºç­–: `.env.test`ã§ã®ãƒ†ã‚¹ãƒˆDBã®æ˜ç¢ºãªè¨­å®š

---

## 7. æ¨å¥¨ã‚¢ã‚¯ã‚·ãƒ§ãƒ³ãƒ—ãƒ©ãƒ³

### Phase 1: åŸºç›¤æ•´å‚™ï¼ˆ1é€±é–“ï¼‰

1. **ãƒ†ã‚¹ãƒˆæ§‹é€ ã®å†ç·¨æˆ**
   ```bash
   # ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã¨åŒã˜å ´æ‰€ã«é…ç½®
   lib/
   â”œâ”€â”€ openai.ts
   â”œâ”€â”€ openai.test.ts  # è¿½åŠ 
   â”œâ”€â”€ ai/
   â”‚   â”œâ”€â”€ tools.ts
   â”‚   â””â”€â”€ tools.test.ts  # è¿½åŠ 
   ```

2. **ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®è¨­å®š**
   ```env
   # .env.test
   DATABASE_URL=postgresql://test_user:test_pass@localhost/mued_test
   ```

3. **MSWã®å°å…¥**
   ```bash
   npm install --save-dev msw@latest
   ```

### Phase 2: é‡è¦æ©Ÿèƒ½ã®ãƒ†ã‚¹ãƒˆå®Ÿè£…ï¼ˆ2é€±é–“ï¼‰

#### é€±1: OpenAI Function Calling
```typescript
// lib/ai/tools.test.ts
describe('AI Tools', () => {
  describe('searchAvailableSlots', () => {
    it('should return available slots based on criteria')
    it('should handle empty results gracefully')
    it('should validate date format')
  })

  describe('generateStudyMaterial', () => {
    it('should generate material with correct difficulty')
    it('should enforce usage limits')
    it('should handle OpenAI errors')
  })
})
```

#### é€±2: Stripeçµ±åˆ
```typescript
// app/api/checkout/route.test.ts
describe('Checkout API', () => {
  it('should create checkout session for valid tier')
  it('should reject invalid subscription tiers')
  it('should handle Stripe API errors')
})
```

### Phase 3: E2Eã‚·ãƒŠãƒªã‚ªã®æ‹¡å……ï¼ˆ1é€±é–“ï¼‰

```typescript
// tests/e2e/user-journey.spec.ts
test.describe('Complete User Journey', () => {
  test('æ–°è¦ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°')
  test('ãƒ¬ãƒƒã‚¹ãƒ³äºˆç´„ãƒ•ãƒ­ãƒ¼')
  test('AIæ•™æç”Ÿæˆã¨åˆ¶é™')
  test('ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰')
})
```

### Phase 4: CI/CDçµ±åˆï¼ˆ3æ—¥ï¼‰

```yaml
# .github/workflows/test.yml
name: Test Suite
on: [push, pull_request]
jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - run: npm ci
      - run: npm run test:unit
      - run: npm run test:integration
      - run: npx playwright install
      - run: npm run test:e2e
      - uses: codecov/codecov-action@v3
```

---

## 8. KPIã¨æˆåŠŸæŒ‡æ¨™

### çŸ­æœŸç›®æ¨™ï¼ˆ1ãƒ¶æœˆï¼‰
- ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸: **70%ä»¥ä¸Š**
- E2Eãƒ†ã‚¹ãƒˆæˆåŠŸç‡: **95%ä»¥ä¸Š**
- CI/CDãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³å®Ÿè¡Œæ™‚é–“: **10åˆ†ä»¥å†…**

### ä¸­æœŸç›®æ¨™ï¼ˆ3ãƒ¶æœˆï¼‰
- ç·åˆãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸: **80%ä»¥ä¸Š**
- ãƒ†ã‚¹ãƒˆå®Ÿè¡Œæ™‚é–“: ãƒ¦ãƒ‹ãƒƒãƒˆ**30ç§’ä»¥å†…**ã€E2E**5åˆ†ä»¥å†…**
- ãƒã‚°æ¤œå‡ºç‡: ãƒªãƒªãƒ¼ã‚¹å‰**90%ä»¥ä¸Š**

---

## 9. æ¨å¥¨ãƒ„ãƒ¼ãƒ«ã¨ãƒªã‚½ãƒ¼ã‚¹

### å¿…é ˆãƒ„ãƒ¼ãƒ«
1. **MSW** (Mock Service Worker) - APIãƒ¢ãƒƒã‚­ãƒ³ã‚°
2. **Testing Library** - React ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆãƒ†ã‚¹ãƒˆ
3. **Codecov** - ã‚«ãƒãƒ¬ãƒƒã‚¸è¿½è·¡
4. **Playwright Test Reporter** - E2Eãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ

### å­¦ç¿’ãƒªã‚½ãƒ¼ã‚¹
1. [Testing Best Practices (2025)](https://testingjavascript.com/)
2. [OpenAI Testing Guide](https://platform.openai.com/docs/testing)
3. [Stripe Testing Documentation](https://stripe.com/docs/testing)

---

## 10. çµè«–ã¨æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

### ç¾çŠ¶ã®è©•ä¾¡
MUED LMS v2ã¯**ãƒ†ã‚¹ãƒˆåŸºç›¤ã¯æ•´å‚™ã•ã‚Œã¦ã„ã‚‹ãŒã€å®Ÿéš›ã®ãƒ†ã‚¹ãƒˆå®Ÿè£…ãŒè‘—ã—ãä¸è¶³**ã—ã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚ãƒ¢ãƒƒã‚¯æˆ¦ç•¥ã¯å„ªã‚Œã¦ã„ã¾ã™ãŒã€æ´»ç”¨ã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚

### ç·Šæ€¥å¯¾å¿œäº‹é …
1. **OpenAI Function Callingã®ãƒ†ã‚¹ãƒˆå®Ÿè£…**ï¼ˆãƒ“ã‚¸ãƒã‚¹ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ï¼‰
2. **Stripeæ±ºæ¸ˆãƒ•ãƒ­ãƒ¼ã®E2Eãƒ†ã‚¹ãƒˆ**ï¼ˆåç›Šã«ç›´çµï¼‰
3. **èªè¨¼ãƒ•ãƒ­ãƒ¼ã®çµ±åˆãƒ†ã‚¹ãƒˆ**ï¼ˆã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ï¼‰

### æ¨å¥¨äº‹é …
æœ€åˆã®2é€±é–“ã§åŸºç›¤æ•´å‚™ã¨ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«ãƒ‘ã‚¹ã®ãƒ†ã‚¹ãƒˆã‚’å®Ÿè£…ã—ã€ãã®å¾Œæ®µéšçš„ã«ã‚«ãƒãƒ¬ãƒƒã‚¸ã‚’å‘ä¸Šã•ã›ã‚‹ã“ã¨ã‚’å¼·ãæ¨å¥¨ã—ã¾ã™ã€‚

---

**å ±å‘Šæ›¸ä½œæˆè€…**: Claude Code Test Architect
**ãƒ¬ãƒ“ãƒ¥ãƒ¼æ—¥**: 2025å¹´10æœˆ18æ—¥
**æ¬¡å›ãƒ¬ãƒ“ãƒ¥ãƒ¼äºˆå®š**: 2025å¹´11æœˆ18æ—¥

---

## ä»˜éŒ²A: ãƒ†ã‚¹ãƒˆå®Ÿè£…ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

### OpenAI Function Callingãƒ†ã‚¹ãƒˆ
```typescript
import { describe, it, expect, beforeEach, vi } from 'vitest'
import { createMockOpenAI } from '@/tests/mocks/openai.mock'
import { searchAvailableSlots } from '@/lib/ai/tools'

describe('searchAvailableSlots', () => {
  let mockOpenAI: ReturnType<typeof createMockOpenAI>

  beforeEach(() => {
    mockOpenAI = createMockOpenAI()
    vi.clearAllMocks()
  })

  it('should return available slots for given criteria', async () => {
    const result = await searchAvailableSlots({
      date: '2025-10-20',
      subject: 'Mathematics'
    })

    expect(result.slots).toBeDefined()
    expect(result.slots.length).toBeGreaterThan(0)
    expect(result.slots[0]).toHaveProperty('id')
    expect(result.slots[0]).toHaveProperty('startTime')
    expect(result.slots[0]).toHaveProperty('mentorName')
  })

  it('should handle API errors gracefully', async () => {
    mockOpenAI = createMockOpenAI({ throwError: true })

    await expect(searchAvailableSlots({
      date: '2025-10-20'
    })).rejects.toThrow('Failed to search slots')
  })
})
```

### Stripe Webhookãƒ†ã‚¹ãƒˆ
```typescript
import { describe, it, expect } from 'vitest'
import { POST } from '@/app/api/webhooks/stripe/route'
import { mockWebhookEvents } from '@/tests/mocks/stripe.mock'

describe('Stripe Webhook Handler', () => {
  it('should process subscription.created event', async () => {
    const request = new Request('http://localhost/api/webhooks/stripe', {
      method: 'POST',
      headers: {
        'stripe-signature': 'mock_signature'
      },
      body: JSON.stringify(mockWebhookEvents.subscriptionCreated)
    })

    const response = await POST(request)
    expect(response.status).toBe(200)

    // Verify database update
    // const user = await getUserById('user_123')
    // expect(user.subscriptionTier).toBe('basic')
  })
})
```

---

## ä»˜éŒ²B: ãƒ†ã‚¹ãƒˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå¿…é ˆé …ç›®
- [ ] ã™ã¹ã¦ã®å…¬é–‹é–¢æ•°ã«æœ€ä½1ã¤ã®ãƒ†ã‚¹ãƒˆ
- [ ] ã‚¨ãƒ©ãƒ¼ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆ
- [ ] å¢ƒç•Œå€¤ã®ãƒ†ã‚¹ãƒˆ
- [ ] éåŒæœŸå‡¦ç†ã®é©åˆ‡ãªãƒ†ã‚¹ãƒˆ

### E2Eãƒ†ã‚¹ãƒˆå¿…é ˆé …ç›®
- [ ] ãƒãƒƒãƒ”ãƒ¼ãƒ‘ã‚¹ã®å®Œå…¨ãªã‚«ãƒãƒ¬ãƒƒã‚¸
- [ ] ã‚¨ãƒ©ãƒ¼å‡¦ç†ã®æ¤œè¨¼
- [ ] ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–ãƒ‡ã‚¶ã‚¤ãƒ³ã®ãƒ†ã‚¹ãƒˆ
- [ ] ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ãƒ†ã‚¹ãƒˆ

### çµ±åˆãƒ†ã‚¹ãƒˆå¿…é ˆé …ç›®
- [ ] ã™ã¹ã¦ã®APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã®ãƒ†ã‚¹ãƒˆ
- [ ] èªè¨¼ãƒ»èªå¯ã®æ¤œè¨¼
- [ ] ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œã®æ¤œè¨¼
- [ ] å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹é€£æºã®ãƒ†ã‚¹ãƒˆ